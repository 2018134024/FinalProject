<!DOCTYPE html>
<html>
    <head>
        <meta charset = 'UTF-8'/>
        <title>subRoom</title>
        <link rel = "stylesheet" type = "text/css" href = "main.css"/> 
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
        <script>
            $(document).ready(function () {
                let temp = location.href.split("?"); 
                let data=temp[1].split("@"); 
                let username = data[0]; 
                let roomName = data[1];
                let roomPersonNum = 0;;
 
                username = decodeURI(username);
                roomName = decodeURI(roomName);

                ////username(접속자), roomName(찾은 방 이름) 중 필요한 정보 서버로 보냄.
                //서버에서 접속한 사람수 가져옴.

                let req = `http://localhost:3000/updateRoom?roomName=${roomName}`;
                $.get(req, function(data, error){
                    roomPersonNum = data.numOfPeople;
                    roomPersonNum = "("+ roomPersonNum + "명이 방에 있습니다)";
                    document.querySelector('#subRoom_p_2').innerHTML = roomPersonNum;
                });
                
                document.querySelector('#subRoom_p_1').innerHTML = `<strong>"${roomName}"</strong> 방`;

                

                //서버로부터 방장이 입력한 url 받아옴. 
                let roomUrl = "https://www.youtube.com/playlist?list=PLx0sYbCqOb8TBPRdmBHs5Iftvv9TPboYG";  //예시:재생목록
                //let roomUrl = "https://youtu.be/MwYq4vAH7bI" //예시:그냥 동영상
                var vid;
                var str;
                if(roomUrl.indexOf('playlist') != -1){//재생목록의 url 가져온 경우 
                    vid = roomUrl.substr(roomUrl.indexOf("list=")+5);
                    str = `<iframe width="600" height="400" src="https://www.youtube.com/embed/videoseries?list=${vid}" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
                }else{//그냥 동영상 url 가져온 경우
                    vid = roomUrl.substr(roomUrl.lastIndexOf('/') + 1);
                    str = `<iframe id="ytplayer" type="text/html" width="600" height="400"
                                src="https://www.youtube.com/embed/${vid}?autoplay=1&origin=http://example.com"
                                frameborder="0"></iframe>`;
                }   


                document.querySelector('#subPlayer').innerHTML = str;
                

            });


        </script> 
    </head>
    <body>
        <div id="subRoom_div">
            <p id="subRoom_p_1"></p>
            <p id="subRoom_p_2"></p>
            <div id="subPlayer"></div>
        </div>
        

    </body>
</html>