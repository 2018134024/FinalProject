<!DOCTYPE html>
<html>
    <head>
        <meta charset = 'UTF-8'/>
        <title>mainRoom</title>
        <link rel = "stylesheet" type = "text/css" href = "main.css"/> 
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
        <script>
            $(document).ready(function () {
                let roomUrl = location.href.substr(location.href.lastIndexOf("@")+1);
                let temp = location.href.split("?"); 
                let data=temp[1].split("@"); 
                let username = data[0]; 
                let roomName = data[1];

                username = decodeURI(username);
                roomName = decodeURI(roomName);
                roomUrl = decodeURI(roomUrl);

                document.querySelector('#mainRoom_p_1').innerHTML = `<strong>"${roomName}"</strong> 방`;

                var vid;
                var str;

                if(roomUrl.indexOf('playlist') != -1){ //재생목록의 url 가져온 경우 
                    vid = temp[2].substr(5);
                    str = `<iframe width="600" height="400" src="https://www.youtube.com/embed/videoseries?list=${vid}"
                        frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
                    
                }else{ //그냥 동영상 url 가져온 경우
                    vid = roomUrl.substr(roomUrl.lastIndexOf('=') + 1);

                    str = `<iframe id="ytplayer" type="text/html" width="600" height="400"
                                src="https://www.youtube.com/embed/${vid}?autoplay=1&origin=http://example.com"
                                frameborder="0"></iframe>`;
                }
                
                //username(방장), roomName(만든 방 이름), roomUrl(선택한 url), vid 중 필요한 정보 서버로 보냄.
                //서버에서 접속한 사람수(클라이언트수+1) 가져옴.

                let req = `http://localhost:3000/updateRoom?roomName=${roomName}`;
                $.get(req, function(data, error){
                    roomPersonNum = data.numOfPeople;
                    roomPersonNum = "("+ roomPersonNum + "명이 방에 있습니다)";
                    document.querySelector('#mainRoom_p_2').innerHTML = roomPersonNum;
                });

                document.querySelector('#player').innerHTML = str;
                
                

            });


        </script> 
        
    </head>
    <body>
        <div id="mainRoom_div">
            <p id="mainRoom_p_1"></p>
            <p id="mainRoom_p_2"></p>
            <div id="player"></div>
        </div>

    </body>
</html>